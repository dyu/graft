Next tasks:
- build the offsets map in the uploader while we serialize the segment
- consume commits in the write pages handler
- write end-to-end write segment test